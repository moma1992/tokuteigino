# Supabaseèªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ“‹ Featureæ¦‚è¦
**Epic Issue**: #1 - [EPIC] Core Learning Platform Development - Phase 1

ç‰¹å®šæŠ€èƒ½è©¦é¨“å­¦ç¿’æ”¯æ´ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã«ãŠã‘ã‚‹Supabaseèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½ã‚’å®Ÿè£…ã€‚æ•™å¸«ãƒ»å­¦ç”Ÿã®å½¹å‰²ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰ã¨Row Level Securityï¼ˆRLSï¼‰ã‚’æ´»ç”¨ã—ãŸã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

## ğŸ¯ ç›®çš„ãƒ»èƒŒæ™¯
- **æ•™å¸«ãƒ»å­¦ç”Ÿã®å½¹å‰²åˆ†é›¢**: ç•°ãªã‚‹æ¨©é™ãƒ»æ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ã‚»ã‚­ãƒ¥ã‚¢ãªèªè¨¼**: Supabase Auth + RLS ã«ã‚ˆã‚‹å …ç‰¢ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ**: æ•™å¸«-å­¦ç”Ÿé–¢ä¿‚ã®åŠ¹ç‡çš„ãªç®¡ç†
- **ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é€£æº**: Stripeæ±ºæ¸ˆã¨ã®çµ±åˆåŸºç›¤

## ğŸ“‹ æ©Ÿèƒ½è¦ä»¶

### ğŸ” èªè¨¼æ©Ÿèƒ½
- [ ] **ãƒ¡ãƒ¼ãƒ«èªè¨¼**: ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ»ã‚µã‚¤ãƒ³ã‚¤ãƒ³
- [ ] **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«èªè¨¼**: Google OAuthï¼ˆä»»æ„ï¼‰
- [ ] **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ**: ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å›å¾©æ©Ÿèƒ½
- [ ] **ãƒ¡ãƒ¼ãƒ«ç¢ºèª**: æ–°è¦ç™»éŒ²æ™‚ã®ãƒ¡ãƒ¼ãƒ«ç¢ºèªãƒ—ãƒ­ã‚»ã‚¹
- [ ] **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ã‚»ã‚­ãƒ¥ã‚¢ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°

### ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- [ ] **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆ**: åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š
- [ ] **å½¹å‰²é¸æŠ**: æ•™å¸«/å­¦ç”Ÿã®å½¹å‰²é¸æŠï¼ˆåˆå›ã®ã¿ï¼‰
- [ ] **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†**: åŸºæœ¬æƒ…å ±ã®æ›´æ–°æ©Ÿèƒ½
- [ ] **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤**: GDPRæº–æ‹ ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ©Ÿèƒ½
- [ ] **å¤šè¨€èªå¯¾å¿œ**: æ—¥æœ¬èªã€è‹±èªã€ä¸­å›½èªã€ãƒ™ãƒˆãƒŠãƒ èªã®UI

### ğŸ« å½¹å‰²ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰
- [ ] **æ•™å¸«æ©Ÿèƒ½**:
  - å­¦ç”Ÿã®æ‹›å¾…ãƒ»ç®¡ç†
  - å­¦ç¿’æ•™æã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  - å­¦ç¿’é€²æ—ã®ç›£è¦–
  - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ç®¡ç†
- [ ] **å­¦ç”Ÿæ©Ÿèƒ½**:
  - æ•™å¸«ã¸ã®å‚åŠ ç”³è«‹
  - å­¦ç¿’è¨˜éŒ²ã®é–²è¦§
  - ç·´ç¿’å•é¡Œã®å®Ÿè¡Œ
  - å€‹äººãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ç®¡ç†

### ğŸ‘¥ æ•™å¸«-å­¦ç”Ÿé–¢ä¿‚ç®¡ç†
- [ ] **æ‹›å¾…ã‚·ã‚¹ãƒ†ãƒ **: æ•™å¸«ã«ã‚ˆã‚‹å­¦ç”Ÿæ‹›å¾…æ©Ÿèƒ½
- [ ] **æ‰¿èªã‚·ã‚¹ãƒ†ãƒ **: å­¦ç”Ÿã®å‚åŠ ç”³è«‹ã¨æ•™å¸«ã®æ‰¿èª
- [ ] **é–¢ä¿‚ç®¡ç†**: æ•™å¸«-å­¦ç”Ÿé–¢ä¿‚ã®è¿½åŠ ãƒ»å‰Šé™¤
- [ ] **ã‚¯ãƒ©ã‚¹ç®¡ç†**: è¤‡æ•°ã‚¯ãƒ©ã‚¹å¯¾å¿œï¼ˆProç‰ˆï¼‰

## ğŸ—ï¸ æŠ€è¡“ä»•æ§˜

### FrontendæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **React 18+** with TypeScript
- **Supabase Auth** for authentication
- **Zustand** for authentication state management
- **React Query** for server state management
- **MUI Components** for UI (Auth forms, Profile pages)
- **React Hook Form** for form validation
- **Zod** for schema validation
- **React Router v6** for protected routes

### BackendæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **Supabase Auth** with email/password
- **PostgreSQL 15** with Row Level Security
- **Supabase Realtime** for real-time updates
- **Supabase Edge Functions** for custom business logic

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
- **Row Level Security (RLS)**: å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã«RLSé©ç”¨
- **JWT Token**: Supabase JWTãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹èªè¨¼
- **Role-based Access**: æ•™å¸«ãƒ»å­¦ç”Ÿå½¹å‰²ã®å³å¯†ãªæ¨©é™ç®¡ç†
- **Data Encryption**: å€‹äººæƒ…å ±ã®é©åˆ‡ãªæš—å·åŒ–

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### Supabase Schema
```sql
-- profiles ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆRLSé©ç”¨ï¼‰
CREATE TABLE profiles (
  id UUID REFERENCES auth.users(id) PRIMARY KEY,
  email TEXT NOT NULL,
  full_name TEXT,
  avatar_url TEXT,
  user_role TEXT NOT NULL CHECK (user_role IN ('teacher', 'student')),
  language_preference TEXT DEFAULT 'ja',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- teacher_students ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ•™å¸«-å­¦ç”Ÿé–¢ä¿‚ï¼‰
CREATE TABLE teacher_students (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  teacher_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  student_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  status TEXT NOT NULL CHECK (status IN ('pending', 'approved', 'rejected')),
  invited_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  approved_at TIMESTAMP WITH TIME ZONE,
  UNIQUE(teacher_id, student_id)
);

-- RLS Policies
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE teacher_students ENABLE ROW LEVEL SECURITY;
```

### TypeScriptå‹å®šç¾©
```typescript
// Supabase Database Types
export interface Profile {
  id: string;
  email: string;
  full_name: string | null;
  avatar_url: string | null;
  user_role: 'teacher' | 'student';
  language_preference: 'ja' | 'en' | 'zh' | 'vi';
  created_at: string;
  updated_at: string;
}

export interface TeacherStudent {
  id: string;
  teacher_id: string;
  student_id: string;
  status: 'pending' | 'approved' | 'rejected';
  invited_at: string;
  approved_at: string | null;
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### Unit Tests (70% - 35 tests)
- **Authentication Hooks**: useAuth, useUser, useSignIn, useSignOut
- **Form Validation**: Zod schemas, form submission logic
- **State Management**: Zustand auth store
- **Utility Functions**: Role checking, permission validation
- **Type Guards**: User role type checking

### Integration Tests (20% - 10 tests)
- **Auth Flow**: Sign up â†’ Email verification â†’ Profile creation
- **Role Assignment**: Teacher/Student role selection and permission
- **Teacher-Student**: Invitation and approval workflow
- **Protected Routes**: Route access based on authentication status
- **Supabase Integration**: Database operations with RLS

### E2E Tests (10% - 5 tests)
- **User Registration**: Complete sign-up workflow
- **Login/Logout**: Authentication state management
- **Profile Management**: User profile creation and updates
- **Role-based Access**: Teacher vs Student feature access
- **Teacher-Student Relationship**: Invitation and approval process

### Testing Setup
```bash
# Docker testing environment
make test-frontend
make test-backend
make test-e2e

# Supabase testing
make supabase-reset
make test-db
```

## ğŸš€ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºæœ¬èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  (Week 1-2)
- [ ] Supabase Auth ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] åŸºæœ¬çš„ãªã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—/ã‚µã‚¤ãƒ³ã‚¤ãƒ³æ©Ÿèƒ½
- [ ] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
- [ ] èªè¨¼çŠ¶æ…‹ç®¡ç†ï¼ˆZustandï¼‰
- [ ] ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã®å®Ÿè£…

### Phase 2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½ (Week 3-4)
- [ ] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆãƒ»ç·¨é›†ç”»é¢
- [ ] å½¹å‰²é¸æŠæ©Ÿèƒ½
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
- [ ] ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ©Ÿèƒ½
- [ ] å¤šè¨€èªå¯¾å¿œ

### Phase 3: å½¹å‰²ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ (Week 5-6)
- [ ] RLS ãƒãƒªã‚·ãƒ¼ã®å®Ÿè£…
- [ ] æ•™å¸«ãƒ»å­¦ç”Ÿå°‚ç”¨æ©Ÿèƒ½ã®åˆ†é›¢
- [ ] æ¨©é™ãƒã‚§ãƒƒã‚¯é–¢æ•°ã®å®Ÿè£…
- [ ] å½¹å‰²åˆ¥ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

### Phase 4: æ•™å¸«-å­¦ç”Ÿé–¢ä¿‚ç®¡ç† (Week 7-8)
- [ ] æ‹›å¾…ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…
- [ ] æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- [ ] é–¢ä¿‚ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### Phase 5: ãƒ†ã‚¹ãƒˆãƒ»æœ€é©åŒ– (Week 9-10)
- [ ] åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè£…
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

## ğŸ’¯ å®Œäº†åŸºæº–

### æ©Ÿèƒ½å®Œäº†æ¡ä»¶
- [ ] å…¨èªè¨¼ãƒ•ãƒ­ãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œ
- [ ] æ•™å¸«ãƒ»å­¦ç”Ÿã®å½¹å‰²ãŒé©åˆ‡ã«åˆ†é›¢
- [ ] RLS ãƒãƒªã‚·ãƒ¼ãŒå…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§æœ‰åŠ¹
- [ ] æ•™å¸«-å­¦ç”Ÿé–¢ä¿‚ã®ç®¡ç†ãŒå®Œå…¨ã«æ©Ÿèƒ½
- [ ] å¤šè¨€èªå¯¾å¿œãŒå®Œäº†

### å“è³ªæ¡ä»¶
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 80% ä»¥ä¸Š
- [ ] TypeScript strict mode ã‚¨ãƒ©ãƒ¼ 0
- [ ] ESLint ã‚¨ãƒ©ãƒ¼ 0
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ç›£æŸ» åˆæ ¼
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ» åˆæ ¼

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¡ä»¶
- [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼å®Œäº†æ™‚é–“ < 3ç§’
- [ ] ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“ < 2ç§’
- [ ] APIå¿œç­”æ™‚é–“ < 500ms
- [ ] ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œå®Œäº†

## ğŸ”§ é–‹ç™ºç’°å¢ƒ

### Docker Development
```bash
# é–‹ç™ºç’°å¢ƒã®èµ·å‹•
make dev

# Supabase ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ
make supabase-start

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒªã‚»ãƒƒãƒˆ
make supabase-reset

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make test
```

### ç’°å¢ƒå¤‰æ•°
```bash
# Supabaseè¨­å®š
VITE_SUPABASE_URL=http://localhost:54322
VITE_SUPABASE_ANON_KEY=your-anon-key

# é–‹ç™ºç’°å¢ƒURL
VITE_SITE_URL=http://localhost:5173
```

## ğŸš¨ ãƒªã‚¹ã‚¯ãƒ»åˆ¶ç´„äº‹é …

### æŠ€è¡“çš„ãƒªã‚¹ã‚¯
- **RLSè¤‡é›‘æ€§**: è¤‡é›‘ãªRLSãƒãƒªã‚·ãƒ¼ã®ãƒ‡ãƒãƒƒã‚°é›£æ˜“åº¦
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§èƒ½**: å¤§é‡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ã®è„†å¼±æ€§

### å¯¾ç­–æ¡ˆ
- **æ®µéšçš„å®Ÿè£…**: æ©Ÿèƒ½ã‚’æ®µéšçš„ã«è¿½åŠ ã—ã¦ãƒ†ã‚¹ãƒˆ
- **åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®å¼·åŒ–
- **ç›£è¦–ä½“åˆ¶**: èªè¨¼ã‚¨ãƒ©ãƒ¼ã®ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ

## ğŸ”— é–¢é€£Issueãƒ»ä¾å­˜é–¢ä¿‚

### å‰ææ¡ä»¶
- [x] #5 - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åŸºç›¤æ§‹ç¯‰ï¼ˆReact + Vite + TypeScriptï¼‰

### é–¢é€£Issueï¼ˆå¾Œç¶šï¼‰
- [ ] #TBD - PDFå‡¦ç†ãƒ»ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºæ©Ÿèƒ½
- [ ] #TBD - å­¦ç¿’è¨˜éŒ²ãƒ»é€²æ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- [ ] #TBD - Stripeæ±ºæ¸ˆãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çµ±åˆ

## ğŸ“š å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [Row Level Security Guide](https://supabase.com/docs/guides/auth/row-level-security)
- [React Integration Guide](https://supabase.com/docs/guides/getting-started/tutorials/with-react)

### å®Ÿè£…ä¾‹
- [Supabase Auth with React](https://github.com/supabase/supabase/tree/master/examples/auth/react-auth)
- [Multi-tenant RLS Examples](https://supabase.com/docs/guides/auth/row-level-security#multi-tenant-applications)

---

**å®Ÿè£…æ‹…å½“**: Claude Code Action  
**äºˆå®šæœŸé–“**: 2-3é€±é–“  
**å„ªå…ˆåº¦**: High - Epic Issue #1 ã®åŸºç›¤æ©Ÿèƒ½