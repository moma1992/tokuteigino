# React Native Testing Dockerfile
FROM node:18-alpine

# Set working directory
WORKDIR /app

# Install system dependencies for testing
RUN apk add --no-cache \
    git \
    python3 \
    make \
    g++ \
    bash \
    curl

# Install global testing dependencies
RUN npm install -g \
    @expo/cli@latest \
    jest \
    typescript

# Create app user
RUN addgroup -g 1001 -S nodejs && \
    adduser -S reactnative -u 1001

# Copy package files
COPY package*.json ./
COPY yarn.lock* ./

# Install dependencies including dev dependencies
RUN yarn install --frozen-lockfile

# Copy source code
COPY . .

# Change ownership to app user
RUN chown -R reactnative:nodejs /app
USER reactnative

# Default command for testing
CMD ["yarn", "test"]